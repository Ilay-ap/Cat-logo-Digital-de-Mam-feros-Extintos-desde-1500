{% extends "detail_scientific.html" %}
{% load static %}
{% load i18n %}

{% block extra_css %}
{{ block.super }}
<style>
.topic-image {
    margin: 2rem 0;
    text-align: center;
}

.topic-image img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: transform 0.3s ease;
}

.topic-image img:hover {
    transform: scale(1.02);
}

.image-caption {
    margin-top: 0.75rem;
    font-size: 0.9rem;
    color: #666;
    font-style: italic;
}

.dossier-content {
    background: white;
    border-radius: 12px;
    padding: 2.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 2px 15px rgba(0,0,0,0.05);
}

.dossier-content h2 {
    color: #1e3c72;
    font-size: 2rem;
    margin-top: 3rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 3px solid #2a5298;
}

.dossier-content h3 {
    color: #2a5298;
    font-size: 1.5rem;
    margin-top: 2rem;
    margin-bottom: 1rem;
}

.dossier-content p {
    line-height: 1.8;
    margin-bottom: 1rem;
    color: #333;
    text-align: justify;
}

.dossier-content ul, .dossier-content ol {
    line-height: 1.8;
    margin-bottom: 1rem;
    padding-left: 2rem;
}

.dossier-content blockquote {
    border-left: 4px solid #2a5298;
    padding-left: 1.5rem;
    margin: 1.5rem 0;
    font-style: italic;
    color: #555;
    background: #f9fafb;
    padding: 1rem 1.5rem;
    border-radius: 0 8px 8px 0;
}

.dossier-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 1.5rem 0;
}

.dossier-content table th,
.dossier-content table td {
    padding: 0.75rem;
    text-align: left;
    border: 1px solid #e0e0e0;
}

.dossier-content table th {
    background: #f5f7fa;
    font-weight: 600;
    color: #1e3c72;
}

/* Modal para imagens */
.image-modal {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.9);
}

.image-modal img {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.image-modal .close {
    position: absolute;
    top: 20px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
}

/* Mapa de distribui√ß√£o */
#distribution-map-container {
    margin: 2rem 0;
    padding: 1.5rem;
    background: #f9fafb;
    border-radius: 8px;
}

#distribution-map {
    height: 500px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

/* Se√ß√£o de coment√°rios integrada */
.comments-section {
    margin-top: 3rem;
    padding: 2rem;
    background: #f9fafb;
    border-radius: 12px;
}

.comments-section h3 {
    color: #1e3c72;
    margin-bottom: 1.5rem;
}

.comment-form {
    margin-bottom: 2rem;
}

.comment-form textarea {
    width: 100%;
    min-height: 100px;
    padding: 1rem;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-family: inherit;
    font-size: 1rem;
    resize: vertical;
}

.comment-form textarea:focus {
    outline: none;
    border-color: #2a5298;
}

.comment-form button {
    margin-top: 1rem;
}

.comment {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.comment-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid #e0e0e0;
}

.comment-author {
    font-weight: 600;
    color: #1e3c72;
}

.comment-date {
    font-size: 0.85rem;
    color: #888;
}

.comment-content {
    color: #333;
    line-height: 1.6;
}

.action-buttons {
    margin: 2rem 0;
    display: flex;
    gap: 1rem;
}

.btn-favorite {
    padding: 0.75rem 1.5rem;
    border: 2px solid #2a5298;
    background: white;
    color: #2a5298;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-favorite:hover {
    background: #2a5298;
    color: white;
}

.btn-favorite.active {
    background: #2a5298;
    color: white;
}
</style>
{% endblock %}

{% block dossier_content %}
<div class="dossier-header">
    <h1>Nesofonte de Atalaye</h1>
    <div class="scientific-name">Nesophontes hypomicrus Miller, 1929</div>
    <div class="status-badge extinct">EXTINTO</div>
</div>

<nav class="dossier-nav">
    <ul>
        <li><a href="#introducao">Introdu√ß√£o</a></li>
        <li><a href="#descoberta">Descoberta</a></li>
        <li><a href="#taxonomia">Taxonomia</a></li>
        <li><a href="#morfologia">Morfologia</a></li>
        <li><a href="#filogenia">Filogenia</a></li>
        <li><a href="#ecologia">Ecologia</a></li>
        <li><a href="#distribuicao">Distribui√ß√£o</a></li>
        <li><a href="#extincao">Extin√ß√£o</a></li>
        <li><a href="#bibliografia">Bibliografia</a></li>
        <li><a href="#comentarios">Coment√°rios</a></li>
    </ul>
</nav>

<article class="dossier-content">

<h2 id="introducao">1. INTRODU√á√ÉO</h2>
<div class="topic-image">
    <img src="{% static 'images/nesophontes_hypomicrus/Reconstrucao_artistica.jpeg' %}" 
         alt="Reconstru√ß√£o art√≠stica do Nesophontes hypomicrus" 
         onclick="openImageModal(this.src)">
    <p class="image-caption">Reconstru√ß√£o art√≠stica do Nesofonte de Atalaye em seu habitat natural</p>
</div>

<p><em>Nesophontes hypomicrus</em>, conhecido como o Nesofonte de Atalaye, foi uma pequena esp√©cie de mam√≠fero inset√≠voro end√™mico da ilha de Hispaniola (Haiti e Rep√∫blica Dominicana). Pertencente √† fam√≠lia extinta Nesophontidae, este animal representa uma linhagem √∫nica de mam√≠feros caribenhos que divergiu de outros inset√≠voros h√° mais de 70 milh√µes de anos. A esp√©cie foi descrita cientificamente apenas em 1929 por Gerrit S. Miller, Jr., com base em restos f√≥sseis encontrados em cavernas no Haiti, muito depois de sua extin√ß√£o.</p>

<p>Apesar de ter sobrevivido por mil√™nios √† presen√ßa humana amer√≠ndia, <em>N. hypomicrus</em>, juntamente com o resto de seu g√™nero, foi levado √† extin√ß√£o rapidamente ap√≥s a chegada dos europeus no final do s√©culo XV. A introdu√ß√£o de esp√©cies invasoras, principalmente ratos (<em>Rattus</em> spp.), √© considerada a principal causa de seu desaparecimento, um padr√£o tr√°gico que se repetiu em todo o Caribe, resultando em uma das mais severas ondas de extin√ß√£o de mam√≠feros do Holoceno.</p>

<p>Este dossi√™ consolida o conhecimento cient√≠fico atual sobre <em>N. hypomicrus</em>, abrangendo sua taxonomia, morfologia, ecologia, comportamento e as circunst√¢ncias de sua extin√ß√£o, com base em publica√ß√µes cient√≠ficas, bases de dados taxon√¥micas e cole√ß√µes de museus.</p>

<h2 id="descoberta">2. HIST√ìRICO DA DESCOBERTA</h2>
<div class="topic-image">
    <img src="{% static 'images/nesophontes_hypomicrus/Holotipo_USNM_PAL_367223.jpg' %}" 
         alt="Hol√≥tipo USNM PAL 367223" 
         onclick="openImageModal(this.src)">
    <p class="image-caption">Hol√≥tipo USNM 253077 - Cr√¢nio usado por Miller na descri√ß√£o original (1929)</p>
</div>

<h3>2.1. As Expedi√ß√µes ao Haiti</h3>
<p>A descoberta de <em>Nesophontes hypomicrus</em> est√° intrinsecamente ligada a uma s√©rie de expedi√ß√µes cient√≠ficas ao Haiti no in√≠cio do s√©culo XX, focadas na explora√ß√£o de dep√≥sitos de ossos em cavernas. O g√™nero <em>Nesophontes</em> ainda n√£o havia sido registrado na ilha de Hispaniola at√© ent√£o.</p>

<ul>
<li><strong>1925 (Gerrit S. Miller, Jr.):</strong> Durante uma expedi√ß√£o de quatro semanas na planta√ß√£o de l'Atalaye, perto de St. Michel, Haiti, o curador da Divis√£o de Mam√≠feros do Museu Nacional dos EUA, Gerrit S. Miller, Jr., coletou um vasto material de uma caverna profunda. Este material continha os restos de v√°rias esp√©cies de mam√≠feros extintos, incluindo os esp√©cimes que se tornariam a s√©rie-tipo de <em>N. hypomicrus</em>.</li>
<li><strong>1927-1928 (Arthur J. Poole):</strong> Uma expedi√ß√£o subsequente, financiada pelo Dr. W. L. Abbott, foi liderada por Arthur J. Poole. Esta expedi√ß√£o provavelmente esgotou os dep√≥sitos √≥sseos mais acess√≠veis das cavernas, mas o material coletado por Miller em 1925 permaneceu a base para a descri√ß√£o de novas esp√©cies.</li>
</ul>

<h3>2.2. A Descri√ß√£o Original (Miller, 1929)</h3>
<p>Em 30 de mar√ßo de 1929, Gerrit S. Miller, Jr. publicou o artigo <strong>"A second collection of Mammals from caves near St. Michel, Haiti"</strong> nas <em>Smithsonian Miscellaneous Collections</em>. Neste trabalho, ele descreveu formalmente tr√™s novas esp√©cies de <em>Nesophontes</em> para a ci√™ncia, incluindo <em>Nesophontes hypomicrus</em>.</p>

<blockquote>
<p>"Inset√≠voros do g√™nero <em>Nesophontes</em> s√£o abundantemente representados nas cavernas haitianas. Eles n√£o foram previamente registrados da ilha de Hispaniola. Na camada superficial dos pisos das cavernas, os ossos destes animais ocorrem em material n√£o perturbado junto com restos de <em>Epimys rattus</em> e <em>Mus musculus</em>. Esta associa√ß√£o √© t√£o √≠ntima que parece n√£o haver raz√£o para duvidar da ocorr√™ncia simult√¢nea dos inset√≠voros e dos roedores introduzidos."</p>
</blockquote>

<p>Miller baseou sua descri√ß√£o em um cr√¢nio quase perfeito (USNM 253077) como o hol√≥tipo, distinguindo a esp√©cie por seu tamanho consistentemente menor em compara√ß√£o com as outras esp√©cies haitianas que ele descreveu (<em>N. paramicrus</em> e <em>N. zamicrus</em>).</p>

<h2 id="taxonomia">3. TAXONOMIA E CLASSIFICA√á√ÉO</h2>

<table>
<thead>
<tr>
<th>N√≠vel Taxon√¥mico</th>
<th>Classifica√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Reino</strong></td>
<td>Animalia</td>
</tr>
<tr>
<td><strong>Filo</strong></td>
<td>Chordata</td>
</tr>
<tr>
<td><strong>Classe</strong></td>
<td>Mammalia</td>
</tr>
<tr>
<td><strong>Ordem</strong></td>
<td>Eulipotyphla</td>
</tr>
<tr>
<td><strong>Fam√≠lia</strong></td>
<td>‚Ä†Nesophontidae</td>
</tr>
<tr>
<td><strong>G√™nero</strong></td>
<td>‚Ä†<em>Nesophontes</em></td>
</tr>
<tr>
<td><strong>Esp√©cie</strong></td>
<td>‚Ä†<em>N. hypomicrus</em></td>
</tr>
</tbody>
</table>

<p><strong>Nome binomial:</strong> <em>Nesophontes hypomicrus</em> Miller, 1929</p>
<p><strong>Etimologia:</strong> O nome gen√©rico <em>Nesophontes</em> deriva do grego <em>nesos</em> (ilha) + <em>phontes</em> (assassino), referindo-se √† sua natureza insular e predat√≥ria. O ep√≠teto espec√≠fico <em>hypomicrus</em> significa "muito pequeno", destacando seu tamanho reduzido em rela√ß√£o a outras esp√©cies do g√™nero.</p>

<h2 id="morfologia">4. MORFOLOGIA</h2>

<h3>4.1. Caracter√≠sticas Cranianas</h3>
<p>O cr√¢nio de <em>N. hypomicrus</em> √© notavelmente pequeno, com comprimento total variando entre 28-32 mm. Apresenta um rostro alongado e estreito, caracter√≠stico de inset√≠voros, com √≥rbitas pequenas indicando h√°bitos noturnos ou crepusculares. A caixa craniana √© relativamente grande em propor√ß√£o ao focinho, sugerindo capacidades sensoriais desenvolvidas.</p>

<h3>4.2. Denti√ß√£o</h3>
<p>A f√≥rmula dent√°ria de <em>Nesophontes</em> √© t√≠pica de inset√≠voros: incisivos afiados, caninos pequenos e molares com c√∫spides pontiagudas adaptadas para perfurar e triturar exoesqueletos de insetos. Os dentes apresentam esmalte bem desenvolvido e desgaste caracter√≠stico de uma dieta inset√≠vora.</p>

<h3>4.3. Esqueleto P√≥s-craniano</h3>
<p>Embora o material p√≥s-craniano seja mais fragment√°rio, os ossos longos sugerem um animal de pequeno porte, com massa corporal estimada entre 20-40 gramas. Os membros eram proporcionalmente curtos, indicando locomo√ß√£o terrestre e possivelmente h√°bitos foss√≥rios.</p>

<h2 id="filogenia">5. FILOGENIA E RELA√á√ïES EVOLUTIVAS</h2>

<p>Estudos moleculares e morfol√≥gicos indicam que a fam√≠lia Nesophontidae representa uma linhagem antiga de mam√≠feros placent√°rios que se separou de outros eulipot√≠flos no Cret√°ceo Superior, h√° aproximadamente 70-76 milh√µes de anos. Esta diverg√™ncia precoce fez dos nesofontes verdadeiros "f√≥sseis vivos" at√© sua extin√ß√£o recente.</p>

<p>A fam√≠lia Nesophontidae √© end√™mica das Grandes Antilhas, com esp√©cies registradas em Cuba, Hispaniola, Porto Rico e possivelmente nas Ilhas Caim√£o. A radia√ß√£o do g√™nero <em>Nesophontes</em> provavelmente ocorreu atrav√©s de eventos de dispers√£o sobre √°gua entre as ilhas caribenhas durante o Cenozoico.</p>

<h2 id="ecologia">6. ECOLOGIA E COMPORTAMENTO</h2>

<h3>6.1. Habitat</h3>
<p>Com base em associa√ß√µes faun√≠sticas e contexto geol√≥gico dos f√≥sseis, <em>N. hypomicrus</em> habitava ambientes florestais √∫midos e √°reas de vegeta√ß√£o densa nas terras baixas e m√©dias de Hispaniola. A presen√ßa de seus restos em dep√≥sitos de cavernas sugere que esses locais eram utilizados como abrigos ou que os animais eram presas de predadores que utilizavam as cavernas.</p>

<h3>6.2. Dieta</h3>
<p>A morfologia dent√°ria e craniana indica uma dieta predominantemente inset√≠vora, provavelmente incluindo besouros, formigas, cupins, larvas e outros invertebrados de solo. A estrutura do focinho sugere capacidade para forragear em serapilheira e possivelmente escavar em busca de presas subterr√¢neas.</p>

<h3>6.3. Comportamento</h3>
<p>Embora n√£o existam observa√ß√µes diretas, infer√™ncias baseadas em morfologia sugerem h√°bitos noturnos ou crepusculares, com atividade de forrageamento no solo da floresta. O tamanho pequeno e a morfologia indicam um animal solit√°rio com territ√≥rios de forrageamento relativamente pequenos.</p>

<h2 id="distribuicao">7. DISTRIBUI√á√ÉO GEOGR√ÅFICA</h2>

<p><em>Nesophontes hypomicrus</em> era end√™mico da ilha de Hispaniola, com registros f√≥sseis concentrados na regi√£o norte do Haiti. Os principais s√≠tios de descoberta incluem:</p>

<ul>
<li><strong>Caverna Atalaye</strong> - St. Michel (Haiti) - Localidade-tipo</li>
<li><strong>Trouing Jean Paul</strong> (Haiti)</li>
<li><strong>Ilha Gon√¢ve</strong> - Anse-√†-Galets (Haiti)</li>
</ul>

<!-- Mapa de Distribui√ß√£o -->
<div id="distribution-map-container">
    <h3>üó∫Ô∏è Mapa de Distribui√ß√£o Hist√≥rica</h3>
    <div id="distribution-map"></div>
</div>

<p>A distribui√ß√£o conhecida pode estar subestimada devido √† amostragem limitada de s√≠tios paleontol√≥gicos em Hispaniola. √â prov√°vel que a esp√©cie tivesse uma distribui√ß√£o mais ampla na ilha antes da chegada dos europeus.</p>

<h2 id="extincao">8. EXTIN√á√ÉO</h2>

<h3>8.1. Cronologia da Extin√ß√£o</h3>
<p>A extin√ß√£o de <em>N. hypomicrus</em> ocorreu no per√≠odo p√≥s-colombiano, provavelmente entre 1500-1600 d.C. A associa√ß√£o √≠ntima de seus restos com ossos de ratos introduzidos (<em>Rattus rattus</em> e <em>Mus musculus</em>) nas camadas superiores de dep√≥sitos de cavernas fornece evid√™ncia clara de que a esp√©cie sobreviveu at√© ap√≥s a chegada dos europeus em 1492.</p>

<h3>8.2. Causas da Extin√ß√£o</h3>
<p>As principais causas da extin√ß√£o incluem:</p>

<ul>
<li><strong>Introdu√ß√£o de esp√©cies invasoras:</strong> Ratos europeus competiram por recursos alimentares e provavelmente predaram ninhos e filhotes.</li>
<li><strong>Destrui√ß√£o de habitat:</strong> Desmatamento para agricultura e assentamentos humanos reduziu drasticamente o habitat dispon√≠vel.</li>
<li><strong>Introdu√ß√£o de predadores:</strong> Gatos, c√£es e mangustos introduzidos representaram novos predadores para os quais a esp√©cie n√£o tinha defesas evolutivas.</li>
<li><strong>Doen√ßas:</strong> Pat√≥genos introduzidos por mam√≠feros invasores podem ter contribu√≠do para o decl√≠nio populacional.</li>
</ul>

<h3>8.3. Contexto Regional</h3>
<p>A extin√ß√£o de <em>N. hypomicrus</em> faz parte de uma onda de extin√ß√µes em massa de mam√≠feros caribenhos no per√≠odo p√≥s-colombiano. Todas as esp√©cies de <em>Nesophontes</em> (8 esp√©cies descritas) foram extintas neste per√≠odo, representando a perda completa de uma fam√≠lia √∫nica de mam√≠feros.</p>

<h2 id="bibliografia">9. REFER√äNCIAS BIBLIOGR√ÅFICAS</h2>

<ol>
<li>MacPhee, R.D.E. & Flemming, C. (1999). "Requiem √Üternam: The Last Five Hundred Years of Mammalian Species Extinctions". In: MacPhee, R.D.E. (ed.). <em>Extinctions in Near Time</em>. Springer.</li>
<li>Brace, S. et al. (2016). "Evolutionary History of the Nesophontidae, the Last Unplaced Recent Mammal Family". <em>Molecular Biology and Evolution</em>, 33(12): 3095-3103.</li>
<li>Miller, G.S. (1929). "A second collection of Mammals from caves near St. Michel, Haiti". <em>Smithsonian Miscellaneous Collections</em>, 81(9): 1-30.</li>
<li>Turvey, S.T. (2009). <em>Holocene Extinctions</em>. Oxford University Press.</li>
<li>Cooke, S.B. et al. (2017). "Anthropogenic extinction dominates Holocene declines of West Indian mammals". <em>Annual Review of Ecology, Evolution, and Systematics</em>, 48: 301-327.</li>
</ol>

</article>

<!-- Bot√µes de A√ß√£o -->
{% if user.is_authenticated %}
<div class="action-buttons">
    <form method="post" action="{% url 'mammals:toggle_favorite' mammal.pk %}" style="display: inline;">
        {% csrf_token %}
        <button type="submit" class="btn-favorite {% if is_favorite %}active{% endif %}">
            {% if is_favorite %}‚≠ê Remover dos Favoritos{% else %}‚òÜ Adicionar aos Favoritos{% endif %}
        </button>
    </form>
</div>
{% endif %}

<!-- Se√ß√£o de Coment√°rios -->
<div class="comments-section" id="comentarios">
    <h3>üí¨ Coment√°rios ({{ comments|length }})</h3>

    {% if user.is_authenticated %}
    <form method="post" action="{% url 'mammals:add_comment' mammal.pk %}" class="comment-form">
        {% csrf_token %}
        <textarea name="content" placeholder="Escreva seu coment√°rio..." required></textarea>
        <button type="submit" class="btn-primary">Enviar Coment√°rio</button>
    </form>
    {% else %}
    <p><a href="{% url 'accounts:login' %}">Fa√ßa login</a> para comentar.</p>
    {% endif %}

    {% if comments %}
    <div class="comments-list">
        {% for comment in comments %}
        <div class="comment">
            <div class="comment-header">
                <span class="comment-author">{{ comment.user.username }}</span>
                <span class="comment-date">{{ comment.created_at|date:"d/m/Y H:i" }}</span>
            </div>
            <div class="comment-content">
                {{ comment.content }}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>Nenhum coment√°rio ainda. Seja o primeiro a comentar!</p>
    {% endif %}
</div>

<!-- Modal para Imagens -->
<div id="imageModal" class="image-modal" onclick="closeImageModal()">
    <span class="close">&times;</span>
    <img id="modalImage" src="" alt="Imagem ampliada">
</div>

<script>
// Fun√ß√£o para abrir modal de imagem
function openImageModal(src) {
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    modal.style.display = 'block';
    modalImg.src = src;
}

// Fun√ß√£o para fechar modal
function closeImageModal() {
    document.getElementById('imageModal').style.display = 'none';
}

// Smooth scroll para navega√ß√£o
document.querySelectorAll('.dossier-nav a').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const targetId = this.getAttribute('href');
        const targetElement = document.querySelector(targetId);
        if (targetElement) {
            targetElement.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});
</script>

<!-- Leaflet para Mapa -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Dados de coordenadas do JSON
    const coordinates = [
        { location: "Caverna Atalaye - St. Michel (Haiti)", lat: 19.5667, lon: -72.1167 },
        { location: "Trouing Jean Paul (Haiti)", lat: 19.3333, lon: -72.3333 },
        { location: "Ilha Gon√¢ve - Anse-√†-Galets (Haiti)", lat: 18.8333, lon: -73.0833 }
    ];

    if (coordinates.length > 0) {
        // Calcular centro
        const avgLat = coordinates.reduce((sum, c) => sum + c.lat, 0) / coordinates.length;
        const avgLon = coordinates.reduce((sum, c) => sum + c.lon, 0) / coordinates.length;

        // Criar mapa
        const map = L.map('distribution-map').setView([avgLat, avgLon], 9);

        // Adicionar camada de tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        // Adicionar marcadores
        coordinates.forEach(coord => {
            L.marker([coord.lat, coord.lon])
                .addTo(map)
                .bindPopup(`<b>${coord.location}</b>`);
        });

        // Ajustar zoom para mostrar todos os marcadores
        const bounds = L.latLngBounds(coordinates.map(c => [c.lat, c.lon]));
        map.fitBounds(bounds, { padding: [50, 50] });
    }
});
</script>

{% endblock %}
